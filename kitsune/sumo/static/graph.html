<!DOCTYPE html>
<meta charset='utf-8'>
<style>

</style>
<body>

<label for="a">a:</label>
<input id="a" value="1" type="textbox">
<br>
<label for="b">b:</label>
<input id="b" value="1" type="textbox">
<br>
<button id="big">Big</button>
<button id="small">Small</button>
<br>


<div id='viz'></div>

<script src='js/libs/d3.js'></script>
<script src='js/libs/d3.chart.js'></script>
<script src='js/graph.js'></script>
<script>

  var G = k.graph;

  var data = [];
  for (var x = 0; x < Math.PI * 8; x += 0.1) {
    data.push({
      x: x,
      a: Math.sin(x),
      b: Math.cos(x),
    });
  }

  var valueFromId = (function() {
    var cache = {};

    function make(id) {
      return function() {
        if (!(id in cache)) {
          cache[id] = parseInt(document.getElementById(id).value);
        }
        return cache[id];
      };
    }

    make.clear = function() {
      cache = {};
    }

    return make;
  })();

  var specs = [
    {
      x: G.get('x'),
      y: G.multiply(G.get('a'), valueFromId('a')),
      stroke: '#f00',
    },
    {
      x: G.get('x'),
      y: G.multiply(G.get('b'), valueFromId('b')),
      stroke: '#0f0',
    },
    {
      x: G.get('x'),
      y: G.add(
        G.multiply(G.get('a'), valueFromId('a')),
        G.multiply(G.get('b'), valueFromId('b'))
      ),
      stroke: '#00f',
    },
  ];

  var graph = d3.select('#viz')
    .chart('SpecLines')
    .width(800)
    .height(150)
    .specs(specs);

  graph.draw(data);

  var matches = function(elem, selector) {
    var method = (elem.matchesSelector ||
                  elem.webkitMatchesSelector ||
                  elem.mozMatchesSelector);
    return method.call(elem, selector);
  }

  document.addEventListener('change', function(e) {
    if (matches(e.target, 'input[type=textbox]')) {
      valueFromId.clear();
      graph.draw(data);
    }
  }, false);

  document.addEventListener('click', function(e) {
    if (matches(e.target, '#big')) {
      graph.width(1300).height(300).draw(data);
    } else if (matches(e.target, '#small')) {
      graph.width(500).height(200).draw(data);
    }
  }, false);
</script>
